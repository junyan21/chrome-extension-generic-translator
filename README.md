# Claude Translator Chrome Extension

Google 翻訳、DeepL っぽい翻訳の Chrome 拡張機能です。Claude API を使用して翻訳を提供します。

## 🌟 主要機能

### 📝 テキスト選択翻訳

- テキストを選択するとフローティングボタンが表示
- DeepL スタイルの翻訳ポップアップで結果を表示

### 🌐 フルページ翻訳

- **Google 翻訳スタイル**: ページ全体を一括翻訳
- **DeepL スタイル**: スクロール時の段階的翻訳（ビューポート優先）
- レイアウト保持機能（元のスタイルを維持）
- 翻訳バーでの進捗表示と制御

### 🎯 高度な翻訳機能

- **翻訳キャッシュ**: 同じテキストの高速再表示
- **バッチ翻訳**: 大量テキストの効率的処理（15,000 トークン/バッチ）

### ⌨️ キーボードショートカット

- `Ctrl/Cmd + Shift + Y`: 選択テキストを翻訳
- `Ctrl/Cmd + Shift + T`: ページ全体を翻訳

### 🎨 スタイル・レイアウト機能

- **元スタイル保持**: フォント、色、レイアウトを維持
- **日本語テキストラッピング**: 長い翻訳文の適切な折り返し
- **可視性制御**: 非表示要素の適切な処理
- **原文/翻訳切り替え**: ワンクリックで表示内容を切り替え

## セットアップ

### 1. 依存関係のインストール

```bash
npm install
```

### 2. ビルド

```bash
npm run build
```

開発時は以下のコマンドでファイル変更を監視:

```bash
npm run watch
```

### 3. Chrome 拡張機能として読み込み

1. Chrome で `chrome://extensions/` を開く
2. 右上の「デベロッパーモード」を ON にする
3. 「パッケージ化されていない拡張機能を読み込む」をクリック
4. `dist` フォルダを選択

### 4. API キーの設定

1. 拡張機能のアイコンを右クリックし「オプション」を選択
2. [Anthropic Console](https://console.anthropic.com/)で API キーを取得
3. 設定画面で API キーを入力して保存
4. 「API キーをテスト」ボタンで設定を確認

## 📖 使い方

### 📝 テキスト選択翻訳

1. ウェブページ上でテキストを選択
2. 表示されるフローティングボタンをクリック
3. DeepL スタイルの翻訳ポップアップが表示される
4. 言語選択ドロップダウンで翻訳方向を変更可能
5. 「⇄」ボタンで言語を入れ替え
6. 「コピー」ボタンで翻訳結果をクリップボードにコピー

### 🌐 フルページ翻訳

**開始方法**:

- 拡張機能のポップアップから「ページ全体を翻訳」をクリック
- ページ上で右クリックして「ページ全体を翻訳」を選択
- キーボードショートカット `Ctrl/Cmd + Shift + T` を使用

**翻訳制御**:

- **翻訳バー**が画面上部に表示され、進捗を確認
- **「原文/翻訳」ボタン**: 原文と翻訳文を切り替え
- **「キャンセル」ボタン**: 翻訳を停止し、元の状態に完全復元

### 💻 ポップアップでのクイック翻訳

1. 拡張機能のアイコンをクリック
2. テキストを入力（多言語対応）
3. 言語が自動検出される
4. 「翻訳する」ボタンをクリック

## プロジェクト構造

```
chrome-extension-generic-translator/
├── dist/               # ビルド出力
├── src/
│   ├── background.ts   # バックグラウンドサービスワーカー
│   ├── content.ts      # コンテンツスクリプト（UI・翻訳制御）
│   ├── popup.ts        # ポップアップのスクリプト
│   ├── options.ts      # 設定画面のスクリプト
│   ├── utils/
│   │   ├── translator.ts           # Claude API翻訳ロジック
│   │   ├── readability-parser.ts   # DeepL風フルページ翻訳エンジン
│   │   ├── dom-parser.ts           # DOM解析・テキスト抽出
│   │   └── language-detector.ts    # 多言語検出・判別
│   ├── styles.css      # コンテンツスクリプト用スタイル
│   └── tailwind.css    # Tailwind CSSビルド済みファイル
├── manifest.json       # 拡張機能マニフェスト
├── popup.html          # ポップアップHTML
├── options.html        # 設定画面HTML
└── icons/              # アイコンファイル
```

## 🔧 技術仕様

### 🏗️ アーキテクチャ

- **Chrome Extension Manifest V3** 対応
- **TypeScript** + **esbuild** による高速ビルド
- **モジュラー設計**: 各機能を独立したユーティリティに分離

### 💡 核心技術

#### 🌐 フルページ翻訳エンジン (`readability-parser.ts`)

- **DeepL 風属性管理**: `data-dl-*` 属性による状態追跡
- **Google 翻訳風レイアウト保持**: 元の CSS スタイルを完全保持
- **バッチ処理**: 15,000 トークン単位での効率的翻訳
- **可視性制御**: IntersectionObserver + MutationObserver
- **スクロール連動翻訳**: ビューポート内要素の動的翻訳

#### 🎯 言語処理 (`language-detector.ts`)

- 日本語・英語・中国語・韓国語の自動判別
- 正規表現ベースの高精度検出
- 混在言語テキストの適切な処理

#### 🚀 翻訳 API (`translator.ts`)

- Claude API (Sonnet 3.5) 統合
- エラーハンドリングと再試行機能
- レスポンス解析とクリーニング

### 🎨 UI/UX 設計

- **DeepL スタイル**: モーダル翻訳ポップアップ
- **Google 翻訳スタイル**: ページ内翻訳バー
- **Tailwind CSS**: レスポンシブ・モダンデザイン
- **ドラッグ&ドロップ**: ポップアップの自由移動

## ⚠️ 注意事項・制限

### 💰 API 利用

- Claude API の利用には料金が発生します
- 大量テキスト翻訳時はトークン制限に注意
- API キーは `chrome.storage.sync` で安全に保存

### 🌐 対応サイト

- 標準的な HTML 構造のウェブサイト
- 動的コンテンツ（JavaScript 生成）に対応
- CSP (Content Security Policy) 準拠

### 🔧 技術制限

- Chrome Extension セキュリティ制約
- Cross-origin API 呼び出し制限
- DOM 操作のパフォーマンス考慮

## ライセンス

MIT ライセンス
